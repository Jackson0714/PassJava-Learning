# 图解 Eureka 心跳机制

你好，我是悟空。

上次我们讲到了 Eureka 的多级缓存机制，这次我们正式进入 Eureka 的服务续约的原理了。

Eureka 客户端为了和 Eureka 服务端保持续约，就要用到心跳机制。

这里的客户端就相当于我们的订单服务、商品服务等。而 Eureka 服务端则是指 Eureka 注册中心这个服务。而保持续约就是客户端隔一段时间就向服务端发送一次心跳，告诉 Eureka 服务端自己的状态是存活的。

对于心跳机制，在很多分布式场景中都有用到，比如 Redis 的主从复制原理、Nacos 的心跳机制等等，其实原理都很相似。我们可以透过 Eureka 底层原理来深入理解心跳机制。

主要涉及以下知识点：

- ① 谁发送的心跳请求？
- ② 多久发送一次？
- ③ 如何发送的？
- ④ 如何接收心跳请求的？
- ⑤ 接收后做了什么事情？

## 谁发送的心跳请求

Eureka 采用的是客户端发送心跳请求给 Eureka 服务端。如下图所示：

![](http://cdn.jayh.club/uPic/image-20220619204817186kYb3jx.png)

上图中有三个微服务：订单服务、商品服务、优惠券服务，都已经成功注册到 Eureka 服务端了（注册中心）。

然后每个微服务自己会单独发送心跳请求给注册中心。

## 多久发送一次

DIscoveryClient 初始化时，会调度一些定时任务，其中一个是 HeartbeatThread，顾名思义，这个就是跟发送心跳有关的线程。

## 如何发送心跳请求的？



## 如何接收心跳请求的？



## 接收后做了什么事情