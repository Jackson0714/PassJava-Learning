https://www.cnblogs.com/luyucheng/p/6265594.html



> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.cnblogs.com](https://www.cnblogs.com/luyucheng/p/6265594.html)

### 一、简介

开启慢查询日志，可以让 MySQL 记录下查询超过指定时间的语句，通过定位分析性能的瓶颈，才能更好的优化数据库系统的性能。

### 二、参数说明

slow_query_log 慢查询开启状态  
slow_query_log_file 慢查询日志存放的位置（这个目录需要 MySQL 的运行帐号的可写权限，一般设置为 MySQL 的数据存放目录）  
long_query_time 查询超过多少秒才记录

### 三、设置步骤

1. 查看慢查询相关参数

[![](http://cdn.jayh.club/uPic/copycodePEO4AD.gif)](javascript:void(0); "复制代码")

```
mysql> show variables like 'slow_query%';
+---------------------------+----------------------------------+
| Variable_name             | Value                            |
+---------------------------+----------------------------------+
| slow_query_log            | OFF                              |
| slow_query_log_file       | /mysql/data/localhost-slow.log   |
+---------------------------+----------------------------------+

mysql> show variables like 'long_query_time';
+-----------------+-----------+
| Variable_name   | Value     |
+-----------------+-----------+
| long_query_time | 10.000000 |
+-----------------+-----------+
```

[![](http://cdn.jayh.club/uPic/copycodePEO4AD.gif)](javascript:void(0); "复制代码")

2. 设置方法  
方法一：全局变量设置  
将 slow_query_log 全局变量设置为 “ON” 状态

```
mysql> set global slow_query_log='ON';
```

设置慢查询日志存放的位置

```
mysql> set global slow_query_log_file='/usr/local/mysql/data/slow.log';
```

查询超过 1 秒就记录

```
mysql> set global long_query_time=1;
```

方法二：配置文件设置  
修改配置文件 my.cnf，在 [mysqld] 下的下方加入

```
[mysqld]
slow_query_log = ON
slow_query_log_file = /usr/local/mysql/data/slow.log
long_query_time = 1
```

3. 重启 MySQL 服务

```
service mysqld restart
```

4. 查看设置后的参数

[![](http://cdn.jayh.club/uPic/copycodePEO4AD.gif)](javascript:void(0); "复制代码")

```
mysql> show variables like 'slow_query%';
+---------------------+--------------------------------+
| Variable_name       | Value                          |
+---------------------+--------------------------------+
| slow_query_log      | ON                             |
| slow_query_log_file | /usr/local/mysql/data/slow.log |
+---------------------+--------------------------------+

mysql> show variables like 'long_query_time';
+-----------------+----------+
| Variable_name   | Value    |
+-----------------+----------+
| long_query_time | 1.000000 |
+-----------------+----------+
```

[![](http://cdn.jayh.club/uPic/copycodePEO4AD.gif)](javascript:void(0); "复制代码")

### 四、测试

1. 执行一条慢查询 SQL 语句

```
mysql> select sleep(2);
```

2. 查看是否生成慢查询日志

```
ls /usr/local/mysql/data/slow.log
```

如果日志存在，MySQL 开启慢查询设置成功！

 下一篇：[MySQL 慢查询（二） - pt-query-digest 详解慢查询日志](http://www.cnblogs.com/luyucheng/p/6265873.html)

查看更多：  
[MySQL 优化](http://www.cnblogs.com/luyucheng/p/6323477.html)  
[MySQL 各存储引擎](http://www.cnblogs.com/luyucheng/p/6306512.html)  
[MySQL 锁详解](http://www.cnblogs.com/luyucheng/p/6297752.html)  
[MySQL 事务](http://www.cnblogs.com/luyucheng/p/6297480.html)  
[MySQL 索引类型](http://www.cnblogs.com/luyucheng/p/6289714.html)