

# 19.如何降低消息队列系统中消息的延迟？

## 监控消息的延迟有两种方式

- 使用消息队列提供的工具，通过监控消息的堆积来完成；

- 通过生成监控消息的方式来监控消息的延迟情况。

### 工具一、

```
./bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group test-consumer-group
```

![](http://cdn.jayh.club/blog/20210701/UN8cCAkncjBE.png?imageslim)

图中的前两列是队列的基本信息，包括话题名和分区名；

第三列是当前消费者的消费进度；

第四列是当前生产消息的总数；

第五列就是消费消息的堆积数（也就是第四列与第三列的差值）。

### 工具二、JMX

![mark](http://cdn.jayh.club/blog/20210701/fI4an74JtoU9.png?imageslim)

### 生成监控消息的方式

你先定义一种特殊的消息，然后启动一个监控程序将这个消息定时地循环写入到消息队列中，消息的内容可以是生成消息的时间戳并且也会作为队列的消费者消费数据。业务处理程序消费到这个消息时直接丢弃掉，而监控程序在消费到这个消息时就可以和这个消息的生成时间做比较，如果时间差达到某一个阈值就可以向我们报警。

![](https://static001.geekbang.org/resource/image/34/7f/34820c0b27e66af37fda116a1a98347f.jpg)

## 减少消息延迟的正确姿势

- 优化消费代码提升性能；

- 增加消费者的数量（这个方式比较简单）。

## 读取性能优化

- 消息的存储。

使用本地磁盘作为存储介质。Page Cache 的存在就可以提升消息的读取速度，

- 零拷贝技术。

